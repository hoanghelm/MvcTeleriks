@{
    ViewData["Title"] = "Maintain Locations";
}

@section Styles {
    <link rel="stylesheet" href="~/css/maintenance/location-maintenance.css" />
}

<div class="p-6 max-w-7xl mx-auto">
    <div class="mb-6">
        <h1 class="text-xl font-bold text-gray-900 mb-2">Maintain Locations</h1>
        <p class="text-gray-600 text-sm">Manage location records by sector, LOB, and department</p>
    </div>

    <div class="card overflow-hidden mb-6" id="searchSection">
        <div class="card-header">
            <h2 class="card-title">Filter Selection</h2>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">
                        Sector <span class="text-red-500">*</span>
                    </label>
                    @(Html.Kendo().DropDownList()
                        .Name("SectorDropDown")
                        .OptionLabel("--Select--")
                        .DataTextField("value")
                        .DataValueField("code")
                        .DataSource(source => source.Read(read => read.Action("GetSectors", "MasterData")))
                        .HtmlAttributes(new
                        {
                            id = "ddlSector"
                        })
                        .Events(e => e.Change("onSectorChange"))
                        )
                </div>

                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">
                        LOB <span class="text-red-500">*</span>
                    </label>
                    @(Html.Kendo().DropDownList()
                        .Name("LOBDropDown")
                        .OptionLabel("--Select--")
                        .DataTextField("value")
                        .DataValueField("code")
                        .HtmlAttributes(new
                        {
                            id = "ddlLOB"
                        })
                        .Events(e => e.Change("onLOBChange"))
                        )
                </div>

                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">
                        Department <span class="text-red-500">*</span>
                    </label>
                    @(Html.Kendo().DropDownList()
                        .Name("DepartmentDropDown")
                        .OptionLabel("--Select--")
                        .DataTextField("value")
                        .DataValueField("code")
                        .HtmlAttributes(new
                        {
                            id = "ddlDepartment"
                        })
                        .Events(e => e.Change("onDepartmentChange"))
                        )
                </div>

                <div class="flex justify-end items-center mt-4">
                    <div class="flex space-x-3">
                        @(Html.Kendo().Button()
                            .Name("btnSearch")
                            .Content("Search")
                            .HtmlAttributes(new { @class = "btn-primary w-full" })
                            .Events(e => e.Click("searchLocations"))
                            )
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="resultsSection" class="card overflow-hidden mb-6">
        <div class="card-header">
            <div class="flex justify-between items-center">
                <h2 class="card-title">Location Records</h2>
                @(Html.Kendo().Button()
                    .Name("btnNewLocation")
                    .Content("New")
                    .HtmlAttributes(new { @class = "btn-primary" })
                    .Events(e => e.Click("newLocationRecord"))
                    )
            </div>
        </div>
        <div class="card-body">
            @(Html.Kendo().Grid<dynamic>()
                .Name("locationGrid")
                .Columns(columns =>
                {
                    columns.Bound("SbaCode").Title("Sector Code").Width(120).Hidden(true);
                    columns.Bound("SbaName").Title("Sector").Width(120);
                    columns.Bound("SbuCode").Title("LOB Code").Width(120).Hidden(true);
                    columns.Bound("SbuName").Title("LOB").Width(120);
                    columns.Bound("DepartmentCode").Title("Department Code").Width(120).Hidden(true);
                    columns.Bound("DepartmentName").Title("Department").Width(150);
                    columns.Bound("LocationCode").Title("Location Code").Width(120).Hidden(true);
                    columns.Bound("LocationName").Title("Description").Width(200);
                    columns.Bound("InactiveDate").Title("Inactive Date").Width(120);
                    columns.Template("<a href='\\#' onclick='editLocationRecord(\"#=SbaCode#\", \"#=SbuCode#\", \"#=DepartmentCode#\", \"#=LocationCode#\"); return false;' class='text-blue-600 hover:text-blue-800'>Edit</a>").Title("Actions").Width(80);
                })
                .Pageable(pageable => pageable
                .Refresh(true)
                .PageSizes(new int[] { 15, 25, 50 })
                .ButtonCount(5))
                .Sortable()
                .Filterable()
                .NoRecords(noRecords => noRecords.Template(@"
            <div class='simple-empty-state'>
            <p>No location records found. Select filters and click search to view records, or click 'New' to add records.</p>
            </div>
            "))
                .DataSource(dataSource => dataSource
                .Custom()
                .PageSize(15)
                .Schema(schema => schema
                .Model(model =>
                {
                    model.Id("Uid");
                    model.Field("SbaCode", typeof(string));
                    model.Field("SbaName", typeof(string));
                    model.Field("SbuCode", typeof(string));
                    model.Field("SbuName", typeof(string));
                    model.Field("DepartmentCode", typeof(string));
                    model.Field("DepartmentName", typeof(string));
                    model.Field("LocationCode", typeof(string));
                    model.Field("LocationName", typeof(string));
                    model.Field("InactiveDate", typeof(string));
                    model.Field("Uid", typeof(string));
                })
                )
                )
                )
        </div>
    </div>

    <div id="entryFormSection" class="card overflow-hidden" style="display: none;">
        <div class="card-header">
            <h2 class="card-title" id="formTitle">Location Details</h2>
        </div>
        <div class="card-body">
            <form id="locationForm" class="space-y-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Sector <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().DropDownList()
                            .Name("FormSectorDropDown")
                            .OptionLabel("--Select--")
                            .DataTextField("value")
                            .DataValueField("code")
                            .DataSource(source => source.Read(read => read.Action("GetSectors", "MasterData")))
                            .HtmlAttributes(new
                            {
                                id = "ddlFormSector"
                            })
                            .Events(e => e.Change("onFormSectorChange"))
                            )
                        <div id="sectorError" class="validation-error"></div>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            LOB <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().DropDownList()
                            .Name("FormLOBDropDown")
                            .OptionLabel("--Select--")
                            .DataTextField("value")
                            .DataValueField("code")
                            .HtmlAttributes(new
                            {
                                id = "ddlFormLOB"
                            })
                            .Events(e => e.Change("onFormLOBChange"))
                            )
                        <div id="lobError" class="validation-error"></div>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Department <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().DropDownList()
                            .Name("FormDepartmentDropDown")
                            .OptionLabel("--Select--")
                            .DataTextField("value")
                            .DataValueField("code")
                            .HtmlAttributes(new
                            {
                                id = "ddlFormDepartment"
                            })
                            )
                        <div id="departmentError" class="validation-error"></div>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Location Code <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().TextBox()
                            .Name("LocationCode")
                            .HtmlAttributes(new
                            {
                                id = "txtLocationCode",
                                @readonly = "readonly",
                                @class = "bg-gray-100"
                            })
                            )
                        <div id="locationCodeError" class="validation-error"></div>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Description <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().TextBox()
                            .Name("LocationName")
                            .Placeholder("Enter location description")
                            .HtmlAttributes(new
                            {
                                id = "txtLocationName",
                                required = "required",
                                maxlength = "100"
                            })
                            )
                        <div id="locationNameError" class="validation-error"></div>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Inactive Date
                        </label>
                        @(Html.Kendo().DatePicker()
                            .Name("InactiveDate")
                            .Format("dd/MM/yyyy")
                            .HtmlAttributes(new
                            {
                                id = "txtInactiveDate"
                            })
                            )
                        <div id="inactiveDateError" class="validation-error"></div>
                    </div>
                </div>

                <div class="flex justify-end space-x-3 pt-6">
                    @(Html.Kendo().Button()
                        .Name("btnCancel")
                        .Content("Cancel")
                        .HtmlAttributes(new { @class = "btn-cancel" })
                        .Events(e => e.Click("cancelLocationEdit"))
                        )
                    @(Html.Kendo().Button()
                        .Name("btnSave")
                        .Content("Save")
                        .HtmlAttributes(new { @class = "btn-primary" })
                        .Events(e => e.Click("saveLocationRecord"))
                        )
                </div>
            </form>
        </div>
    </div>
</div>

<div id="notification"></div>

@section Scripts {
    <script src="~/js/maintenance/location-maintenance.js"></script>
    <script>
        $(document).ready(function() {
            locationMaintenanceViewModel.init();
        });
    </script>
}
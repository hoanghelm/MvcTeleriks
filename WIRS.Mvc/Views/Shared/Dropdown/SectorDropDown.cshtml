@* Refactored to use JavaScript framework - no more ViewBag dependency *@
@(Html.Kendo().DropDownList()
    .Name(ViewData.TemplateInfo.GetFullHtmlFieldName(""))
    .DataTextField("Value")
    .DataValueField("Code")
    .OptionLabel("Select Sector")
    .HtmlAttributes(new { @class = "form-control", style = "width: 100%" })
    .AutoBind(false)
)

<script>
$(document).ready(function() {
    $(document).on('framework:ready', function() {
        // Initialize sector dropdown using the framework
        const fieldName = '@ViewData.TemplateInfo.GetFullHtmlFieldName("")';
        const sectorDropdown = window.DropdownFactory.createSectorDropdown('#' + fieldName, null, {
            onChange: function(value, dataItem, e) {
                // Call existing global change handler if it exists
                if (typeof onSectorChange === 'function') {
                    onSectorChange(e);
                }
            }
        });

        // Store reference for cleanup if needed
        if (!window.pageDropdowns) {
            window.pageDropdowns = {};
        }
        window.pageDropdowns[fieldName] = sectorDropdown;
    });
});
</script>
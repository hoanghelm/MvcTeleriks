@using System.Security.Policy
@model IncidentCreateViewModel
@{
    ViewData["Title"] = "Create Incident Report";
}

@section Styles {
    <link rel="stylesheet" href="~/css/telerik-controls-standardized.css" />
    <link rel="stylesheet" href="~/css/incident/incident-create.css" />
    <link rel="stylesheet" href="~/css/components/employee-search.css" />
}

<div class="p-6 max-w-7xl mx-auto">
    <div class="mb-6">
        <h1 class="text-xl font-bold text-gray-900 mb-2">Create Incident Report</h1>
        <p class="text-gray-600 text-sm">Fields marked with <span class="text-red-500 font-semibold">*</span> are required</p>
        <div class="text-blue-600 text-sm mt-2">This form is for <strong>Part A - Initial Report</strong> only</div>
    </div>

    @if (!string.IsNullOrEmpty(Model.ValidationMessage))
    {
        <div class="mb-4 p-3 bg-red-50 border border-red-200 text-red-700 text-sm rounded">
            @Model.ValidationMessage
        </div>
    }

    <form id="createIncidentForm" method="post" action="@Url.Action("Create", "Incident")" class="space-y-6">
        <!-- Incident Details Card -->
        <div class="card overflow-hidden">
            <div class="card-header">
                <h2 class="card-title">Incident Details</h2>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Incident Date -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Incident Date <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().DatePicker()
                            .Name("IncidentDate")
                            .Value(DateTime.Today)
                            .HtmlAttributes(new { 
                                id = "dpIncidentDate", 
                                required = "required"
                            })
                        )
                    </div>

                    <!-- Incident Time -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Incident Time <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().TimePicker()
                            .Name("IncidentTime")
                            .Value(DateTime.Now)
                            .HtmlAttributes(new { 
                                id = "tpIncidentTime", 
                                required = "required"
                            })
                        )
                    </div>

                    <!-- SBA -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            SBA <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().DropDownList()
                            .Name("SbaCode")
                            .OptionLabel("Select SBA")
                            .DataTextField("Value")
                            .DataValueField("Code")
                            .BindTo(Model.SbaOptions ?? new List<LookupItem>())
                            .HtmlAttributes(new { 
                                id = "ddlSbaCode", 
                                required = "required"
                            })
                            .Events(e => e.Change("onSbaChange"))
                        )
                    </div>

                    <!-- SBU -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            SBU <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().DropDownList()
                            .Name("SbuCode")
                            .OptionLabel("Select SBU")
                            .DataTextField("Value")
                            .DataValueField("Code")
                            .BindTo(Model.SbuOptions ?? new List<LookupItem>())
                            .HtmlAttributes(new { 
                                id = "ddlSbuCode", 
                                required = "required"
                            })
                            .Events(e => e.Change("onSbuChange"))
                        )
                    </div>

                    <!-- Division -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Division
                        </label>
                        @(Html.Kendo().DropDownList()
                            .Name("Division")
                            .OptionLabel("Select Division")
                            .DataTextField("Value")
                            .DataValueField("Code")
                            .BindTo(Model.DivisionOptions ?? new List<LookupItem>())
                            .HtmlAttributes(new { id = "ddlDivision" })
                            .Events(e => e.Change("onDivisionChange"))
                        )
                    </div>

                    <!-- Department -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Department <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().DropDownList()
                            .Name("Department")
                            .OptionLabel("Select Department")
                            .DataTextField("Value")
                            .DataValueField("Code")
                            .BindTo(Model.DepartmentOptions ?? new List<LookupItem>())
                            .HtmlAttributes(new { 
                                id = "ddlDepartment", 
                                required = "required"
                            })
                        )
                    </div>

                    <!-- Location -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Location <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().DropDownList()
                            .Name("Location")
                            .OptionLabel("Select Location")
                            .DataTextField("Value")
                            .DataValueField("Code")
                            .BindTo(Model.LocationOptions ?? new List<LookupItem>())
                            .HtmlAttributes(new { 
                                id = "ddlLocation", 
                                required = "required"
                            })
                        )
                    </div>

                    <!-- Exact Location -->
                    <div class="space-y-2 xl:col-span-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Exact Location <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().TextBox()
                            .Name("ExactLocation")
                            .Placeholder("Enter exact location details")
                            .HtmlAttributes(new { 
                                id = "txtExactLocation", 
                                required = "required",
                                maxlength = "500"
                            })
                        )
                    </div>
                </div>

                <!-- Incident Description -->
                <div class="mt-6 space-y-2">
                    <label class="block text-sm font-medium text-gray-700">
                        Incident Description <span class="text-red-500">*</span>
                    </label>
                    @(Html.Kendo().TextArea()
                        .Name("IncidentDesc")
                        .Placeholder("Describe the incident in detail")
                        .Rows(4)
                        .HtmlAttributes(new { 
                            id = "txtIncidentDesc", 
                            required = "required",
                            maxlength = "2000"
                        })
                    )
                </div>
            </div>
        </div>

        <!-- Superior Information Card -->
        <div class="card overflow-hidden">
            <div class="card-header">
                <h2 class="card-title">Superior Information</h2>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Superior Employee Number -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Superior Employee Number <span class="text-red-500">*</span>
                        </label>
                        <div class="flex gap-2">
                            <div class="flex-1">
                                @(Html.Kendo().TextBox()
                                    .Name("SuperiorEmpNo")
                                    .Placeholder("Employee number")
                                    .HtmlAttributes(new { 
                                        id = "txtSuperiorEmpNo", 
                                        required = "required"
                                    })
                                )
                            </div>
                            <button type="button" class="btn-primary" onclick="openSuperiorSearch()">Search</button>
                        </div>
                    </div>

                    <!-- Superior Name -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Superior Name <span class="text-red-500">*</span>
                        </label>
                        @(Html.Kendo().TextBox()
                            .Name("SuperiorName")
                            .Placeholder("Superior's name")
                            .HtmlAttributes(new { 
                                id = "txtSuperiorName", 
                                required = "required",
                                readonly = "readonly"
                            })
                        )
                    </div>

                    <!-- Superior Designation -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Superior Designation
                        </label>
                        @(Html.Kendo().TextBox()
                            .Name("SuperiorDesignation")
                            .Placeholder("Superior's designation")
                            .HtmlAttributes(new { 
                                id = "txtSuperiorDesignation",
                                readonly = "readonly"
                            })
                        )
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Information Card -->
        <div class="card overflow-hidden">
            <div class="card-header">
                <h2 class="card-title">Additional Information</h2>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Any Eyewitness -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Any Eyewitness?
                        </label>
                        <select name="AnyEyewitness" id="ddlAnyEyewitness" class="form-control">
                            <option value="">Select option</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>

                    <!-- Working Overtime -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Was Working Overtime?
                        </label>
                        <select name="IsWorkingOvertime" id="ddlIsWorkingOvertime" class="form-control">
                            <option value="">Select option</option>
                            <option value="Y">Yes</option>
                            <option value="N">No</option>
                        </select>
                    </div>

                    <!-- Job Related -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Job Related?
                        </label>
                        <select name="IsJobrelated" id="ddlIsJobrelated" class="form-control">
                            <option value="">Select option</option>
                            <option value="Y">Yes</option>
                            <option value="N">No</option>
                        </select>
                    </div>

                    <!-- Injured Case Type -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            Injured Case Type
                        </label>
                        @(Html.Kendo().DropDownList()
                            .Name("InjuredCaseType")
                            .OptionLabel("Select type")
                            .BindTo(Model.InjuredCaseTypeOptions ?? new List<LookupItem>())
                            .DataTextField("Value")
                            .DataValueField("Code")
                            .HtmlAttributes(new { id = "ddlInjuredCaseType" })
                        )
                    </div>
                </div>

                <!-- Damage Description -->
                <div class="mt-6 space-y-2">
                    <label class="block text-sm font-medium text-gray-700">
                        Damage Description
                    </label>
                    @(Html.Kendo().TextArea()
                        .Name("DamageDescription")
                        .Placeholder("Describe any damages")
                        .Rows(3)
                        .HtmlAttributes(new { 
                            id = "txtDamageDescription",
                            maxlength = "1000"
                        })
                    )
                </div>

                <!-- Hospital/Clinic Name -->
                <div class="mt-6 space-y-2">
                    <label class="block text-sm font-medium text-gray-700">
                        Examined at Hospital/Clinic
                    </label>
                    @(Html.Kendo().TextBox()
                        .Name("ExaminedHospitalClinicName")
                        .Placeholder("Hospital or clinic name")
                        .HtmlAttributes(new { 
                            id = "txtExaminedHospitalClinicName",
                            maxlength = "200"
                        })
                    )
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex justify-end space-x-4">
            <button type="button" class="btn-secondary" onclick="cancelForm()">Cancel</button>
            <button type="button" class="btn-primary" onclick="saveDraft()">Save Draft</button>
            <button type="submit" class="btn-success">Submit Report</button>
        </div>
    </form>
</div>


@section Scripts {
    <script src="~/js/incident/incident-create-viewmodel.js"></script>
    <script src="~/js/components/employee-search.js"></script>
    <script src="~/js/telerik-notifications.js"></script>
}